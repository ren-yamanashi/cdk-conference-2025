### 掴み(5分)

それでは、TypeScript エコシステムで築く AWS CDK の品質基盤 というタイトルでお話しさせていただきます。よろしくお願いします

まず最初に、軽く自己紹介をさせていただきます。
山梨 蓮と申します。  
株式会社メイツでバックエンドエンジニアをしています。  
CDK が好きで、気が向いた時に CDK だったり、Projen というツールに PullRequest や Issue を提出したりしています

今日のイベントで登壇される方は AWS や CDK のエキスパートだったり、ソフトウェアにおけるインフラのエキスパートという側面が強い印象なのですが、私はそうではなくて、どちらかというと TypeScript やそのエコシステムに関しての方が知識があるので、今日はその辺りの話を CDK と絡めてしていきたいと思います

では、ここから本題に入っていきます。

こちらは、AWS CDK でどのプログラミング言語を利用しているか。のアンケート結果になります。  
ご覧の通り TypeScript が圧倒的なシェアを誇っているのですが、なぜ私たちはTypeScriptで CDK を利用しているんでしょうか

そもそも CDK ライブラリ自体が TypeScript を第一級にサポートしている、というかそれ自体が TypeScript で実装されているというのが大きな理由だと思いますが、型システムを備えた言語である。というのも、理由の一つだと思います。

この型システムというのは非常に便利で、私たちが書いたプログラムがある種の性質を満たすことを保証してくれます。

例えば、Construct のプロパティの型に一致する値を代入することで、実行時のある種のエラーが起きないことを保証してくれます。

それにより、Construct のプロパティにどのような値を代入すれば良いのか。というのが容易に予測でき、AWS のエキスパートでなくても、ある一定の安全性が保証されたプログラムを記述することができます。  
CloudFormation だと、そうはいきません。

そのことによる恩恵は、TypeScript などの型システムを備えたプログラミング言語で CDK を書いている人であれば実感できることと思います。

<!--
TypeScript はやや特殊な言語で、その型システムには型安全性が厳密に保証されていないケースもありますが、それでも、CDK を書く上では十分に役立ちます。
-->

一方で、もう少し視野を広げて、細かい部分まで見てみると、TypeScript の型システムだけでは十分に保証されない部分があると思います。  

つまり、TypeScript が問題ないですよ。と判断したコードであっても、CDK においては問題があるようなケース。  
あるいは、TypeScript のレイヤーでも、CDK のレイヤーでも問題はないけど、セオリー的にはこう書くのがいい。みたいなケースです。

Construct ID に関する例だと、PascalCase で書きましょうとか、変数をなるべく使用しないようにしましょう。のようなものがその例に該当するかと思います。

そういった CDK 固有のルール。というかセオリー・ベストプラクティスみたいなものを満たす TypeScript のコードを書くのってまあまあ大変だと私は感じています。
特に私のような CDK のエキスパートでないエンジニアにとっては。

ただ、そういった言語とライブラリを組みわせた時のセオリーやベストプラクティスが、言語自体のセオリーやベストプラティスから逸脱したり、あるいはより複雑なものになるというのはまあ当たり前の話で、  
JavaScript や TypeScript においては、それをエコシステム。主にLinterなどの静的解析ツールを使用して、ある程度セオリー通りのコードが書けるようにサポートしてあげるというのが、一般的かなと思います。

この辺りは、vue や react などの Web フレームワークで顕著に現れている印象です。

一方で、CDKにおいてはそのようなツールが公式からは提供されていません。  

まあそもそも CDK において重要なのは AWS というか CloudFormation のフロントエンドとしての機能だと思うので、TypeScript やそのエコシステムに関心が向いていないのかもしれません。

一応こちらの issue で、eslint というツールを使用して、CDK 独自の静的解析をするツールを作ろうぜというのを rico 氏が提案されているようですが、現状あまり動きはなさそうです。

その結果、TypeScript から逸脱した、CDK 固有の部分。つまり型システムだけでは検知しきれない部分については、社内やチームにいる CDK のエキスパートエンジニアにレビューしてもらうなどの手段で、一定の安全性を保証するアプローチを選択している場合が多いのではと思います。

今回のセッションでは、そういった課題と向き合う方法として、CDK 固有の TypeScript コードをどのように静的解析して、セオリーやベストプラクティスを検出するかという内容についてお話ししたいと思います。

### eslint-cdk-plugin の紹介(4分)

先ほども少し触れましたが、JavaScript / TypeScript ではライブラリ固有のセオリーやベストプラクティスに沿ったコードであるかを検出するツールとして、Linter を使用することが主流です。
CDK も TypeScript や JavaScript から見たらただのライブラリなので、その慣習に倣って、Linter を使用する方針を取りたいと思います。
  
ESLint というのはその中 Linter の中でも特に人気があるライブラリで、その理由の一つとして独自のルールを作れるというのがあります。

ライブラリやそのコミュニティが独自のルールをユーザーに対して提供することで、そのライブラリ独自のセオリーやベストプラクティスを静的解析によって検出できるという感じです。

CDK であれば、先ほども触れたような Construct ID の命名規則だったり、Construct の Props の型に対するものが検出できます。

まあ何はともあれ、実際の動きを見ていただくのがわかりやすいと思うので、動かしてみたいと思います

CDK にESLintを導入する方法については、こちらの記事で詳しく解説していますので、ぜひご覧いただけたらと思います。

- eslint では型システムも使用している

### まとめ(1分)
